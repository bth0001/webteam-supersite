<% include ../partials/header %>

<style>
		/* The Modal (background) */
		.modal {display: none; position: fixed; z-index: 1;	left: 0; top: 0; width: 100%; height: 100%;	overflow: auto; background-color: rgb(0, 0, 0);	background-color: rgba(0, 0, 0, 0.7);}
		/* Modal Content/Box */
		.modal-content {background-color: transparent; margin: 3% auto; padding: 0; border: none; max-width: 60%;}
		/* Exit form */
		.form-exit {display: flex; font-size: 1em; margin: 0 0 10px;}
		/* The Close Button */
		.close {opacity: 1; color: rgba(0,0,0,0.6);	font-size: 3em;	font-weight: bold; text-align: right; float: none;	width: 100%;
		line-height: .5em; text-shadow: none;}
		.close:hover, .close:focus {color: rgba(0,0,0,0.9);	text-decoration: none; cursor: pointer;}
		.close:not(:disabled):not(.disabled):focus, .close:not(:disabled):not(.disabled):hover {color: rgba(0,0,0,0.9)}
		#myBtn {margin: 10px 0;	cursor: pointer;}
		</style>
		<div id="overview" class="center">
			<h1><%= currentUser.team %> Tracker</h1>
			<div class="flexbox flexCenter">
				<h4 id="myBtn">Track Something<i class="fas fa-plus"></i></h4>
			</div>
			<% if(currentUser.team === "Developer") { %>
				<a href="/tracker/archive"><h4>Archives</h4></a>
			<% } %>
		</div>
		<% function countEssential() { %>
			<% var essCount = 0; var strCount = 0; var prodCount = 0; var tlinkCount = 0; var contentCount = 0; %>
				<% tracking.forEach(function(tracked){ %>
					<%	for(var i = 0; i < tracked.taskTypes.length; i++){ %>
						<% if(currentUser.firstName === tracked.author.firstName) { %>
							<% if(tracked.buildPkg === "Starter" && tracked.taskTypes[i].taskTypeName === "Site Build" && tracked.archive == !true){ %>
								<% strCount++ %>
							<% } %>
							<% if(tracked.buildPkg === "Essential" && tracked.taskTypes[i].taskTypeName === "Site Build" && tracked.archive == !true){ %>
								<% essCount++ %>
							<% } %>
							<% if(tracked.taskTypes[i].taskTypeName === "Production Change" && tracked.archive == !true){ %>
								<% prodCount++ %>
							<% } %>
							<% if(tracked.taskTypes[i].taskTypeName === "T.LINK Branding" && tracked.archive == !true){ %>
								<% tlinkCount++ %>
							<% } %>
							<% if(tracked.taskTypes[i].taskTypeName === "Content Entry" && tracked.archive == !true){ %>
								<% contentCount++ %>
							<% } %>
						<% } %>
					<% } %>
		<% }); %>
		<div class="container">
			<h3 class="pageHeader" style="text-align: center;"> <%= currentUser.firstName %>, this is where you will track any of your completed tasks. </h3>
			<h4 style="text-align: center;"><span class="showEssentials">Essentials:</span> <%= essCount %> | <span class="showStarter">Starters:</span> <%= strCount %> | <span class="showProd">Prod Change:</span> <%= prodCount %> | <span class="showTlink">T.LINK Branding:</span> <%= tlinkCount %> | <span class="showContent">Content Entry:</span> <%= contentCount %></h4>
		</div>
<div id="dashboard">
	<div class="container">
		<div class="developer flexbox flexLeft">
			<div class="selectTeamMember">
				<dl class="dropdown">
					<dt> <a>
						<h4 class="activeUser"><%= currentUser.firstName %></h4>
						<i class="fas fa-angle-down"></i> </a> </dt>
					<dd>
						<ul id="allTeamMembers">
							<li><a>All</a></li>
							<% users.forEach(function(user){ %>
							<% if(user.team == 'Developer') { %>
							<li><a><%= user.firstName %></a></li>
							<% } %>
							<% }); %>
						</ul>
					</dd>
				</dl>
			</div>
		</div>
		<div id="bottomRow" class="flexbox">
			<div class="widget fullCol">
				<div id="dashEssential">
					<h2>Essential Builds</h2>
					<div class="table">
						<div class="row title flexbox">
							<div class="cell url">Website URL</div>
							<div class="cell actNumber">Account Number</div>
							<div class="cell name">Designer</div>
							<div class="cell name">OnBoarder</div>
							<div class="cell date">Date</div>
							<div class="cell arrow"></div>
						</div>
						<div id="accordion">
							<% tracking.forEach(function(tracked){ %>
							<% if(currentUser.firstName === tracked.author.firstName) { %>
							<% if(tracked.buildPkg === "Essential" && tracked.archive == !true){ %>
							<div class="row flexbox">
								<div class="cell url"><a href="<%= tracked.domain %>"><%= tracked.domain %></a></div>
								<div class="cell actNumber"><%= tracked.acctNum %></div>
								<div class="cell name"><%= tracked.designer %></div>
								<div class="cell name"><%= tracked.onboarder %></div>
								<div class="cell date"><%= tracked.date %></div>
								<div class="cell arrow" data-panel-id="panel1"><i class="fas fa-angle-down"></i></div>
								<div class="expanded" style="display:none">
									<p><strong>Special Features:</strong> <%= tracked.specialFeatures %> </p>
									<p><strong>CSS Path:</strong> <%= tracked.cssPath %></p>
									<p><strong>Task:</strong></p>
									<ul>
										<% for(i = 0; i < tracked.taskTypes.length; i++) { %>
										<li><%= tracked.taskTypes[i].taskTypeName %> / <%= tracked.taskTypes[i].quantity %> / <%= tracked.taskTypes[i].taskNotes %></li>
										<% }; %>
									</ul>
									<p><strong>Notes:</strong> <%= tracked.notes %></p>
									<a href="/tracker/<%= tracked._id %>/edit">
										<button class="btn btn-xs btn-primary">Edit Task</button>
										</a> 
										<form id="delete-form" class="trackerForm" action="/tracker/<%= tracked._id %>?_method=PUT" method="POST"></form>
											<button class="archiveButton" value="Archive" name="tracking[archive]" type="submit">Archive</button>
										</form>
										<script> 
												$(document).ready(function(){
													$("#delete-form button.archiveButton").click(function(){
														$("#delete-form button.archiveButton").each(function(){
															$(this).val("true");
														});
													});
												}); 
											</script> 
								</div>
								<!-- end of expanded --> 								
							</div>
							<% } %>
							<% } %>
							<% }); %>
						</div>
					</div>
				</div>
				<!-- end of dashEssential -->
				<div id="dashStarter">
					<h2>Starter Builds</h2>
					<div class="table">
						<div class="row title flexbox">
							<div class="cell url">Website URL</div>
							<div class="cell actNumber">Account Number</div>
							<div class="cell name">Designer</div>
							<div class="cell name">OnBoarder</div>
							<div class="cell date">Date</div>
							<div class="cell arrow"></div>
						</div>
						<div id="accordion">
							<% tracking.forEach(function(tracked){ %>
							<% if(currentUser.firstName === tracked.author.firstName) { %>
							<% if(tracked.buildPkg === "Starter" && tracked.archive == !true){ %>
							<div class="row flexbox">
								<div class="cell url"><a href="<%= tracked.domain %>"><%= tracked.domain %></a></div>
								<div class="cell actNumber"><%= tracked.acctNum %></div>
								<div class="cell name"><%= tracked.designer %></div>
								<div class="cell name"><%= tracked.onboarder %></div>
								<div class="cell date"><%= tracked.date %></div>
								<div class="cell arrow" data-panel-id="panel2"><i class="fas fa-angle-down"></i></div>
								<div class="expanded" style="display:none">
									<p><strong>Starter Template:</strong> <%= tracked.starterTemplate %></p>
									<p><strong>Task:</strong></p>
									<ul>
										<% for(i = 0; i < tracked.taskTypes.length; i++) { %>
										<li><%= tracked.taskTypes[i].taskTypeName %> / <%= tracked.taskTypes[i].quantity %> / <%= tracked.taskTypes[i].taskNotes %></li>
										<% }; %>
									</ul>
									<p><strong>Notes:</strong> <%= tracked.notes %></p>
								</div>
								<!-- end of expanded --> 
							</div>
							<% } %>
							<% } %>
							<% }); %>
						</div>
					</div>
				</div>
				<!-- end of dashStarter -->
				<div id="dashProd">
					<h2>Prod Changes</h2>
					<div class="table">
						<div class="row title flexbox">
							<div class="cell url">Website URL</div>
							<div class="cell actNumber">Account Number</div>
							<div class="cell name">Designer</div>
							<div class="cell name">OnBoarder</div>
							<div class="cell date">Date</div>
							<div class="cell arrow"></div>
						</div>
						<div id="accordion">
							<% tracking.forEach(function(tracked){ %>
							<% if(currentUser.firstName === tracked.author.firstName) { %>
							<%	for(var i = 0; i < tracked.taskTypes.length; i++){ %>
							<% if(tracked.taskTypes[i].taskTypeName === "Production Change" && tracked.archive == !true){ %>
							<div class="row flexbox">
								<div class="cell url"><a href="<%= tracked.domain %>"><%= tracked.domain %></a></div>
								<div class="cell actNumber"><%= tracked.acctNum %></div>
								<div class="cell name"><%= tracked.designer %></div>
								<div class="cell name"><%= tracked.onboarder %></div>
								<div class="cell date"><%= tracked.date %></div>
								<div class="cell arrow" data-panel-id="panel2"><i class="fas fa-angle-down"></i></div>
								<div class="expanded" style="display:none">
									<p><strong>Build Package:</strong> <%= tracked.buildPkg %></p>
									<p><strong>Server:</strong> <%= tracked.server %></p>
									<p><strong>Task:</strong></p>
									<ul>
										<% for(i = 0; i < tracked.taskTypes.length; i++) { %>
										<li><%= tracked.taskTypes[i].taskTypeName %> / <%= tracked.taskTypes[i].quantity %> / <%= tracked.taskTypes[i].taskNotes %></li>
										<% }; %>
									</ul>
									<p><strong>Notes:</strong> <%= tracked.notes %></p>
								</div>
								<!-- end of expanded --> 
							</div>
							<% } %>
							<% } %>
							<% } %>
							<% }); %>
						</div>
					</div>
				</div>
				<!-- end of dashProd -->
				<div id="dashTlink">
					<h2>T.LINK Branding</h2>
					<div class="table">
						<div class="row title flexbox">
							<div class="cell url">Website URL</div>
							<div class="cell actNumber">Account Number</div>
							<div class="cell name">Designer</div>
							<div class="cell name">OnBoarder</div>
							<div class="cell date">Date</div>
							<div class="cell arrow"></div>
						</div>
						<div id="accordion">
							<% tracking.forEach(function(tracked){ %>
							<% if(currentUser.firstName === tracked.author.firstName) { %>
							<%	for(var i = 0; i < tracked.taskTypes.length; i++){ %>
							<% if(tracked.taskTypes[i].taskTypeName === "T.LINK Branding" && tracked.archive == !true){ %>
							<div class="row flexbox">
								<div class="cell url"><a href="<%= tracked.domain %>"><%= tracked.domain %></a></div>
								<div class="cell actNumber"><%= tracked.acctNum %></div>
								<div class="cell name"><%= tracked.designer %></div>
								<div class="cell name"><%= tracked.onboarder %></div>
								<div class="cell date"><%= tracked.date %></div>
								<div class="cell arrow" data-panel-id="panel2"><i class="fas fa-angle-down"></i></div>
								<div class="expanded" style="display:none">
									<p><strong>Build Package:</strong> <%= tracked.buildPkg %></p>
									<p><strong>Server:</strong> <%= tracked.server %></p>
									<p><strong>Task:</strong></p>
									<ul>
										<% for(i = 0; i < tracked.taskTypes.length; i++) { %>
										<li><%= tracked.taskTypes[i].taskTypeName %> / <%= tracked.taskTypes[i].quantity %> / <%= tracked.taskTypes[i].taskNotes %></li>
										<% }; %>
									</ul>
									<p><strong>Notes:</strong> <%= tracked.notes %></p>
								</div>
								<!-- end of expanded --> 
							</div>
							<% } %>
							<% } %>
							<% } %>
							<% }); %>
						</div>
					</div>
				</div>
				<!-- end of dashTlink -->
				<div id="dashContent">
					<h2>Content</h2>
					<div class="table">
						<div class="row title flexbox">
							<div class="cell url">Website URL</div>
							<div class="cell actNumber">Account Number</div>
							<div class="cell name">Designer</div>
							<div class="cell name">OnBoarder</div>
							<div class="cell date">Date</div>
							<div class="cell arrow"></div>
						</div>
						<div id="accordion">
							<% tracking.forEach(function(tracked){ %>
							<% if(currentUser.firstName === tracked.author.firstName) { %>
							<%	for(var i = 0; i < tracked.taskTypes.length; i++){ %>
							<% if(tracked.taskTypes[i].taskTypeName === "Content Entry" && tracked.archive == !true){ %>
							<div class="row flexbox">
								<div class="cell url"><a href="<%= tracked.domain %>"><%= tracked.domain %></a></div>
								<div class="cell actNumber"><%= tracked.acctNum %></div>
								<div class="cell name"><%= tracked.designer %></div>
								<div class="cell name"><%= tracked.onboarder %></div>
								<div class="cell date"><%= tracked.date %></div>
								<div class="cell arrow" data-panel-id="panel2"><i class="fas fa-angle-down"></i></div>
								<div class="expanded" style="display:none">
									<p><strong>Build Package:</strong> <%= tracked.buildPkg %></p>
									<p><strong>Server:</strong> <%= tracked.server %></p>
									<p><strong>Task:</strong></p>
									<ul>
										<% for(i = 0; i < tracked.taskTypes.length; i++) { %>
										<li><%= tracked.taskTypes[i].taskTypeName %> / <%= tracked.taskTypes[i].quantity %> / <%= tracked.taskTypes[i].taskNotes %></li>
										<% }; %>
									</ul>
									<p><strong>Notes:</strong> <%= tracked.notes %></p>
								</div>
								<!-- end of expanded --> 
								
							</div>
							<% } %>
							<% } %>
							<% } %>
							<% }); %>
						</div>
					</div>
				</div>
				<!-- end of dashContent --> 
			</div>
			<% } %>
			<% countEssential(); %>
		</div>
		<!-- end statsContainer --> 
	</div>
	<!-- end stats --> 
</div>
<div id="tracker">
		<div class="trackerContainer"> 
			<!-- The Modal -->
			<div id="myModal" class="modal"> 
		<!-- Modal content -->
		<div class="modal-content">
			<div>
				<form class="trackerForm" action="/tracker" method="POST">
					<div class="form-exit"> <span class="close">&times;</span></div>
					<div class="form-group">
						<label name="date">Date:
							<input type="date" name="teamTrack[date]" />
						</label>
						<label name="acctNum" />
						Account Number:
						<input type="number" required name="teamTrack[acctNum]" placeholder="######" >
						</label>
					</div>
					<!-- end of form-group -->
					
					<div class="form-group">
						<label name="username">Developer:
							<input type="text" name="teamTrack[username]" value="<%= currentUser.firstName %>" />
						</label>
						<label name="server">Server:
							<select name="teamTrack[server]" id="server">
								<option value="" selected>Select Server</option>
								<option value="Presence">Presence</option>
								<option value="DNN">DNN</option>
								<option value="T.LINK">T.LINK</option>
							</select>
						</label>
					</div>
					<!-- end of form-group -->
					
					<div class="form-group">
						<label name="designer">Designer:
							<select name="teamTrack[designer]" id="designer">
								<option value="" selected>Select Designer</option>
								<option value="">N/A</option>
								<!-- If site is a Starter -->
								<% users.forEach(function(user){ %>
								<% if(user.team == 'Designer') { %>
								<option name="designer" value="<%= user.firstName %>"><%= user.firstName %></option>
								<% } %>
								<% }); %>
							</select>
						</label>
						<label name="onboarder">On-Boarder:
							<select name="teamTrack[onboarder]">
								<option value="Select On-Boarder" selected>Select On-Boarder</option>
								<% users.forEach(function(user){ %>
								<% if(user.team == 'On-Boarder') { %>
								<option name="onboarder" value="<%= user.firstName %>"><%= user.firstName %></option>
								<% } %>
								<% }); %>
							</select>
						</label>
					</div>
					<!-- end of form-group -->
					
					<div class="form-group">
						<label name="buildPkg">Build Package:
							<select name="teamTrack[buildPkg]" id="buildPkg">
								<option value="" disabled selected>Select Build Package</option>
								<option value="Essential">Essential</option>
								<option value="Starter">Starter</option>
							</select>
						</label>
						<label name="starterTemplate" class="ifStarter">Starter Template:
							<select name="teamTrack[starterTemplate]" class="starterClearInput">
								<option value="" disabled>Select Template</option>
								<option value="Neverland">Neverland</option>
								<option value="Atlantis">Atlantis</option>
								<option value="Camelot">Camelot</option>
								<option value="Olympus">Olympus</option>
							</select>
						</label>
					</div>
					<!-- end of form-group -->
					
					<div class="form-group">
						<label name="specialFeatures" class="ifEssential">Special Features:
							<select name="teamTrack[specialFeatures]" class="essentialClearInput" multiple>
								<option value="" disabled>Select Features</option>
								<option value=" None">None</option>
								<option value=" Breadcrumbs">Breadcrumbs</option>
								<option value=" Interior Featured Image">Interior Featured Image</option>
								<option value=" Mega Menu">Mega Menu</option>
								<option value=" Object Fit">Object Fit</option>
								<option value=" Shrinky Header">Shrinky Header</option>
								<option value=" Search Bar">Search Bar</option>
								<option value=" Scroll Efects">Scroll Effects</option>
							</select>
						</label>
					</div>
					<!-- end of form-group -->
					
					<div class="form-group">
						<label name="domain">Domain:
							<input type="text" name="teamTrack[domain]" placeholder="Domain">
						</label>
						<label name="cssPath" class="ifEssential">CSS Path:
							<input type="text" name="teamTrack[cssPath]" placeholder="CSS Path" class="essentialClearInput">
						</label>
					</div>
					<!-- end of form-group --> 
					<div class="form-group" id="task">
						<label class="labelTask" name="taskTypeName">
						<h3>Task:</h3>
						</label>
						<button type='button' id='addTask'>+</button>
						<button type='button' id='removeTask'>-</button>
						<div class="task">
							<select class="taskType">
								<option value="T.LINK Branding">Content Entry</option>
								<option value="Production Change">Production Change</option>
								<option value="Site Build">Site Build</option>
								<option value="T.LINK Branding">T.LINK Branding</option>
							</select>
							<select class="taskQuantity">
								<option value="N/A">N/A</option>
								<option value="0 - 15">0 - 5</option>
								<option value="6 - 15">6 - 10</option>
								<option value="11 - 15">11 - 15</option>
								<option value="16 - 20">16 - 20</option>
								<option value="21 - 25">21 - 25</option>
								<option value="26+">26+</option>
							</select>
							<input class="taskNotes" type="text" placeholder="Notes">
						</div>
					</div>
					<!-- end of form-group -->
					
					<div class="form-group">
						<label class="labelNotes" name="notes">Notes:
							<textarea name="teamTrack[notes]"></textarea>
						</label>
					</div>
					<!-- end of form-group -->
					<button>Submit</button>
				</form>
			</div>
		</div>
	</div>
<script>
// Get the tracker modal
var modal = document.getElementById('myModal');
var btn = document.getElementById("myBtn");
var span = document.getElementsByClassName("close")[0];
// When the user clicks on the button, open the modal 
btn.onclick = function () {
  modal.style.display = "block";
}
// When the user clicks on <span> (x), close the modal
span.onclick = function () {
  modal.style.display = "none";
}
// When the user clicks anywhere outside of the modal, close it
window.onclick = function (event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
// Name field for tasktypes
$(document).ready(function(){
	var count = 0;
	$("div.task:first-of-type select.taskType").attr("name", "teamTrack[taskTypes][" + count + "][taskTypeName]");
	$("div.task:first-of-type select.taskQuantity").attr("name", "teamTrack[taskTypes][" + count + "][quantity]");
	$("div.task:first-of-type input.taskNotes").attr("name", "teamTrack[taskTypes][" + count + "][taskNotes]");

	$("#addTask").click(function () {               
		count++;        
		var newTaskInput = $(".task:last-of-type"); 
		newTaskInput.clone().appendTo("#task"); 
		$("div.task:last-of-type select.taskType").attr("name", "teamTrack[taskTypes][" + count + "][taskTypeName]");
		$("div.task:last-of-type select.taskQuantity").attr("name", "teamTrack[taskTypes][" + count + "][quantity]");
		$("div.task:last-of-type input.taskNotes").attr("name", "teamTrack[taskTypes][" + count + "][taskNotes]");
	});

	$("#removeTask").click(function () {
		var taskCount = $("div.task").length;
		if (taskCount === 1) {
			alert("You cannot remove the only task");
		} else {
		var newTaskInput = $(".task:last-of-type");
		newTaskInput.remove();
		};
	});
});			

// Hide Special Features, Starter Template and CSS Path inputs initially
$('.ifEssential').hide();
$('.ifStarter').hide();

$(function() {
	$('#buildPkg').on('change', function(){
		// If Build Package selection is "Essential" then show Special Features and CSS Path fields
		// Reset to default selection for Starter Template dropdown
		if ($(this).val() === 'Essential'){
			$('.ifEssential').show();
			$('.starterClearInput').prop('selectedIndex',0);
		}
		else {
			// If "Essential" is not chosen then keep associated fields hidden
			$('.ifEssential').hide();
		}
    // If Build Package selection is "Starter" then show Starter Template dropdown
    // Reset to selections/input fields for Special Features and CSS Path
        if ($(this).val() === 'Starter'){
            $('.ifStarter').show();
            $('.essentialClearInput').val("");
        }  

        else {
            // If "Starter" is not chosen then keep associated fields hidden
            $('.ifStarter').hide();
        }
    });
});
//Archive Function on click
$(document).ready(function(){
    $("#delete-form button.archiveButton").click(function(){
        $("#delete-form button.archiveButton").each(function(){
            $(this).val("true");
        });
    });
}); 

// list of team members drop down when you click the purple arrow beside your name
$('.selectTeamMember .fa-angle-down').click(function() {
	$('#allTeamMembers').slideToggle();
});

// when you click the purple arrow beside a task it expands for further info
$('#accordion .fa-angle-down').click(function() {
	$(this).parent().next('.expanded').slideToggle();
});

// when you click on essentials circle it shows tracked essential tasks
$('.showEssentials').click(function() {
	$('#dashStarter, #dashTlink, #dashProd, #dashContent').hide();
	$('#bottomRow, #dashEssential').fadeIn("slow");
});
// when you click on essentials circle it shows tracked starter tasks
$('.showStarter').click(function() {
	$('#dashEssential, #dashTlink, #dashProd, #dashContent').hide();
	$('#bottomRow, #dashStarter').fadeIn("slow");
});
// when you click on essentials circle it shows tracked starter tasks
$('.showProd').click(function() {
	$('#dashTlink, #dashEssential, #dashContent, #dashStarter').hide();
	$('#bottomRow, #dashProd').fadeIn("slow");
});
// when you click on essentials circle it shows tracked starter tasks
$('.showTlink').click(function() {
	$('#dashProd, #dashEssential, #dashContent, #dashStarter').hide();
	$('#bottomRow, #dashTlink').fadeIn("slow");
});
// when you click on essentials circle it shows tracked starter tasks
$('.showContent').click(function() {
	$('#dashProd, #dashEssential, #dashTlink, #dashStarter').hide();
	$('#bottomRow, #dashContent').fadeIn("slow");
});

</script>
<% include ../partials/footer %>