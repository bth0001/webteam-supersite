<% include partials/header %>
<script src="/scripts/dashboard.js"></script>
<div id="overview" class="center">
	<h1>
		<%= currentUser.team %> Dashboard</h1>
	<div class="flexbox flexCenter">
		<!-- <h4 id="thisMonth">August</h4> -->
		<!-- <i class="fas fa-angle-down"></i>  -->
		<div class="selectMonth">
			<dl class="dropdown selectMonth">
				<dt>

						<form id="dateFilter" action="" method="POST">
								<input type="date" id="startDate" />
								<input type="date" id="endDate" />
						</form>
						
						<i class="fas fa-angle-down"></i>
					
				</dt>
				<dd>
					<ul id="allMonths">
						<li><a>January</a></li>
						<li><a>February</a></li>
						<li><a>March</a></li>
						<li><a>April</a></li>
						<li><a>May</a></li>
						<li><a>June</a></li>
						<li><a>July</a></li>
						<li><a>August</a></li>
						<li><a>September</a></li>
						<li><a>October</a></li>
						<li><a>November</a></li>
						<li><a>December</a></li>
					</ul>
				</dd>
			</dl>
		</div>
	</div>
</div>
<% function countEssential() { %>
<% var essCount = 0; var strCount = 0; var prodCount = 0; var tlinkCount = 0; var contentCount = 0; var projectCount = 0%>
<% tracking.forEach(function(tracked){ %>
<%	for(var i = 0; i < tracked.taskTypes.length; i++){ %>
<% if(currentUser.email === tracked.author.email) { %>
<% if(tracked.buildPkg === "Starter" && tracked.taskTypes[i].taskTypeName === "Site Build" && tracked.archive == !true){ %>
<% strCount++ %>
<% } %>
<% if(tracked.buildPkg === "Essential" && tracked.taskTypes[i].taskTypeName === "Site Build" && tracked.archive == !true){ %>
<% essCount++ %>
<% } %>
<% if(tracked.taskTypes[i].taskTypeName === "Production Change" && tracked.archive == !true){ %>
<% prodCount++ %>
<% } %>
<% if(tracked.taskTypes[i].taskTypeName === "T.LINK Branding" && tracked.archive == !true){ %>
<% tlinkCount++ %>
<% } %>
<% if(tracked.taskTypes[i].taskTypeName === "Content Entry" && tracked.archive == !true){ %>
<% contentCount++ %>
<% } %>
<% } %>
<% } %>
<% }); %>
<% projects.forEach(function(project){ %>
<%	for(var i = 0; i < project.owners.length; i++){ %>
<% if(currentUser.firstName === project.owners[i].firstName) { %>
<% if(project.status === "Completed"){ %>
<% projectCount++ %>
<% } %>
<% } %>
<% } %>
<% }); %>
<div id="dashboard">
	<div class="container">
		<div class="developer flexbox flexLeft">
			<div class="selectTeamMember">
				<dl class="dropdown">
					<dt>
						<a>
							<h4 class="activeUser" id="active">
								<%= currentUser.firstName %>
							</h4>
							<i class="fas fa-angle-down"></i>
						</a>
					</dt>
					<dd>


						<ul id="allTeamMembers">
							<li class="all"><a>All</a></li>
							<% var teamsArray = []; %>
							<% users.forEach(function(user){ %>
								<% if(teamsArray.indexOf(user.team) === -1) { %>
									<% 	teamsArray.push(user.team) %>
								<% } %>
							<% }); %>
							<% teamsArray = (teamsArray).sort() %>
							<% teamsArray.forEach(function(team) { %>
							<li><a href="#"><%= team %></a><ul class="submenu">
								<% users.forEach(function(user){ %>
									<% if(user.team === team){ %>
										<% if (JSON.stringify(currentUser._id) === JSON.stringify(user._id)) { %>
										<li>
											<a href="#" class="checked" onclick="return false;"><%= user.firstName %></a>
											<input type="checkbox" name="users" value="<%= user._id %>" checked>
										</li>
										<% } else { %>
										<li>
											<a href="#" class="" onclick="return false;"><%= user.firstName %></a>
											<input type="checkbox" name="users" value="<%= user._id %>">
										</li>
										<% } %>
									<% } %>
								<% }); %>
							</ul>
							</li>
							<% }); %>
						</ul>
					</dd>
				</dl>
			</div>
		</div>
		<div id="topRow" class="flexbox">
			<div class="widget leftCol">
				<div class="table graph">
					<h2>Site Builds</h2>
					<div class="wrapper flexbox">
						<div class="column flexbox">
							<div class="cell graph"><span class="circle showEssentials">
									<%= essCount %></span></div>
							<div class="cell build">Essentials</div>
						</div>
						<div class="column flexbox">
							<div class="cell graph"><span class="circle showStarter">
									<%= strCount %></span></div>
							<div class="cell build">Starters</div>
						</div>
					</div>
				</div>
			</div>
			<!-- End leftCol -->

			<div class="widget rightCol tasks">
				<div class="table">
					<div class="row flexbox showProd">
						<div class="cell task">Prod Change</div>
						<div class="cell taskNumber">
							<%= prodCount %>
						</div>
					</div>
					<div class="row flexbox showTlink">
						<div class="cell task">T.LINK</div>
						<div class="cell taskNumber">
							<%= tlinkCount %>
						</div>
					</div>
					<div class="row flexbox showContent">
						<div class="cell task">Content Entry</div>
						<div class="cell taskNumber">
							<%= contentCount %>
						</div>
					</div>
					<div class="row flexbox showProject">
						<div class="cell task">Projects Completed</div>
						<div class="cell taskNumber">
							<%= projectCount %>
						</div>
					</div>
				</div>
			</div>
			<!-- End rightCol -->
		</div>
		<!-- End topRow -->


		<div id="bottomRow" class="flexbox" style="display:block">
			<div class="widget fullCol">
				
			</div>

			<% } %>
			<!-- </p> -->
			<% countEssential(); %>
		</div><!--BOTTOM-->
		<!-- end statsContainer -->
	</div>
	<!-- end stats -->
</div>
<!-- end dashboard -->
<script>
	$(document).ready(function () {
		$('#bob span').click(function (event) {
			event.preventDefault();
			$('.widgetDisplay').hide();
			var id = $(this).data("id");
			$('#' + id).fadeIn(function () {
				$(this).css({
					'display': 'block'
				}, 1000);
			});
		});

		//if(window.location.href.match('/dashboard')){
		// $("body").addClass("dashboard");
		// }

		// list of team members drop down when you click the purple arrow beside your name
		$('.selectTeamMember .fa-angle-down').click(function () {
			$('#allTeamMembers').slideToggle();
		});
		$('.selectMonth .fa-angle-down').click(function () {
			$('#allMonths').slideToggle();
		});

		// when you click the purple arrow beside a task it expands for further info
		$('#accordion .fa-angle-down').click(function () {
			$(this).parent().next('.expanded').slideToggle();
		});

		// when you click on essentials circle it shows tracked essential tasks
		$('.showEssentials').click(function () {
			$('#dashStarter, #dashTlink, #dashProd, #dashContent, #dashProject').hide();
			$('#bottomRow, #dashEssential').fadeIn("slow");
		});
		// when you click on essentials circle it shows tracked starter tasks
		$('.showStarter').click(function () {
			$('#dashEssential, #dashTlink, #dashProd, #dashContent, #dashProject').hide();
			$('#bottomRow, #dashStarter').fadeIn("slow");
		});
		// when you click on essentials circle it shows tracked starter tasks
		$('.showProd').click(function () {
			$('#dashTlink, #dashEssential, #dashContent, #dashStarter, #dashProject').hide();
			$('#bottomRow, #dashProd').fadeIn("slow");
		});
		// when you click on essentials circle it shows tracked starter tasks
		$('.showTlink').click(function () {
			$('#dashProd, #dashEssential, #dashContent, #dashStarter, #dashProject').hide();
			$('#bottomRow, #dashTlink').fadeIn("slow");
		});
		// when you click on essentials circle it shows tracked starter tasks
		$('.showContent').click(function () {
			$('#dashProd, #dashEssential, #dashTlink, #dashStarter, #dashProject').hide();
			$('#bottomRow, #dashContent').fadeIn("slow");
		});
		// when you click on essentials circle it shows tracked starter tasks
		$('.showProject').click(function () {
			$('#dashProd, #dashEssential, #dashTlink, #dashStarter, #dashContent').hide();
			$('#bottomRow, #dashProject').fadeIn("slow");
		});
	});
</script>
<% include partials/footer %>